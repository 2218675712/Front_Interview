# 浏览器缓存机制

## **缓存的类型（按是否需要向服务器确认分类）** ：

浏览器缓存通常分为两大类：**强制缓存（Strong Cache）** 和**协商缓存（Negotiated Cache/Weak Cache）** 。它们的工作流程是相互配合的。

### 浏览器缓存机制总结

| 特性 / 缓存类型 | 强制缓存 (Strong Cache)                                                                                                     | 协商缓存 (Negotiated Cache / Weak Cache)                     |
| ----------------- | ----------------------------------------------------------------------------------------------------------------------------- | -------------------------------------------------------------- |
| **概念**                | 浏览器在缓存有效期内不向服务器发送请求，直接从本地缓存中获取资源。                                                          | 强制缓存失效后，浏览器带上缓存标识向服务器询问资源是否更新。 |
| **优先级**                | **高** (优先判断，如果有效则不进行协商缓存)                                                                                       | **次之** (强制缓存失效后才进行，或 `no-cache` 强制触发)                        |
| **判断依据**                | 资源是否在指定的缓存有效期内。                                                                                              | 服务器判断本地缓存资源与最新资源是否一致（通过标识符）。     |
| **控制响应头**                | `Expires` (HTTP/1.0, 绝对时间)<br />`Cache-Control` (HTTP/1.1, 相对时间，更推荐)<br />(如 `max-age`, `public`, `private`, `s-maxage`)                                                           | `Last-Modified` (资源最后修改时间)<br />`ETag` (资源唯一标识符，通常是哈希值)         |
| **发送请求头**                | **无** (如果命中强制缓存，不发送任何请求到服务器)                                                                                 | `If-Modified-Since` (对应 `Last-Modified`)<br />`If-None-Match` (对应 `ETag`)                                           |
| **返回状态码**                | `200 OK (from disk cache)`<br />`200 OK (from memory cache)`                                                                                                                          | **资源未更新:**  `304 Not Modified`<br />**资源已更新:**  `200 OK` (并返回新资源)                                          |
| **网络请求**                | **无** (不发送HTTP请求到服务器，速度最快)                                                                                         | **有** (发送HTTP请求到服务器，但可能不传输完整响应体)              |
| **典型场景**                | 静态资源（CSS, JS, 图片）的长期缓存。                                                                                       | 动态内容，或需要频繁验证的资源。                             |
| **优点**                | 速度极快，完全不占用网络带宽，极大减轻服务器压力。                                                                          | 确保资源是最新的，同时在资源未变化时避免传输完整数据。       |
| **缺点**                | 在缓存有效期内，即使服务器资源更新，客户端也无法感知。                                                                      | 仍需发送HTTP请求，存在网络延迟；服务器仍需处理请求和比对。   |
| **失效方式**                | 1. 缓存过期。<br />2. 用户清空缓存。<br />3. 手动刷新（通常会触发协商缓存）。<br />4. `Ctrl+F5` 或 `Shift+F5` (强制刷新)。<br />5. **修改资源URL (加版本号/哈希值)**  是最常用且推荐的更新策略。 | 1. `Last-Modified` 或 `ETag` 不匹配。<br />2. 服务器配置不返回 `304`。                     |

**重要说明：**

- **`Cache-Control: no-cache`**：这个指令比较特殊，它**不是不缓存**，而是要求浏览器在每次使用缓存前，**必须先与服务器进行协商验证**。因此，它实际上是强制触发协商缓存。
- **`Cache-Control: no-store`**：这个指令是真正的**不缓存**，浏览器每次都会从服务器下载完整的资源。
- **`ETag`** **的优先级**：如果响应头同时包含 `Last-Modified` 和 `ETag`，浏览器会优先使用 `ETag` 进行协商缓存。
- **缓存存储位置**：

    - **Memory Cache (内存缓存)** ：生命周期短，浏览器会话结束即清除，速度最快。
    - **Disk Cache (磁盘缓存)** ：生命周期长，硬盘存储，浏览器关闭后依然存在，速度次之。
    - **Service Worker Cache**：由Service Worker脚本控制，灵活性最高，可实现离线访问等。

理解并合理利用这两种缓存机制，是Web性能优化的关键。

## html css js img有什么不同，关于缓存这块

- **HTML文件倾向于“协商缓存”或短时强缓存**，以确保内容不过时，并依赖于内部引用来更新其他资源。
- **CSS、JavaScript和图片等静态资源倾向于“长期强缓存”** ，以最大限度地利用缓存优势。
-  **“文件名哈希化”（Cache Busting）是更新静态资源最可靠的方法**，它通过改变文件名来强制浏览器下载新版本，完美地解决了强缓存带来的更新问题。

通过这种分层缓存策略，可以达到最佳的性能和用户体验：HTML文件确保了内容的及时性，而大量静态资源则被高效地缓存，减少了不必要的网络请求。